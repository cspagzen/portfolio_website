<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chris Spagnuolo - Blog</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
      .pagination { display:flex; gap:.5rem; align-items:center; justify-content:center; margin-top:1.5rem; }
      .page-link { padding:.5rem .8rem; border:1px solid #e1e5ee; border-radius:8px; text-decoration:none; color:#333; }
      .page-link.active { background:#667eea; color:#fff; border-color:#667eea; }
      .page-link.disabled { opacity:.4; pointer-events:none; }
    </style>
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="logo">Chris Spagnuolo</a>
            <div class="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="resume.html">Experience</a></li>
                <li><a href="testimonials.html">Testimonials</a></li>
                <li><a href="blog.html" class="active">Blog</a></li>
                <li><a href="index.html#contact">Contact</a></li>
            </ul>
        </nav>
    </header>

    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <h1>Insights & Perspectives</h1>
                <div class="subtitle">Real talk about building products, leading teams, and turning around stalled companies. Twenty years of wins, fails, and everything in between.</div>
            </div>
        </div>
        <div class="scroll-indicator">▼</div>
    </section>

    <main class="main-content">
        <section class="section">
            <div class="container">
                <h2 class="section-title">Latest Articles</h2>
                <div class="section-subtitle">Fresh writing from the blog</div>
                <div id="latest-posts" class="thought-leadership-grid"></div>
                <div id="pager" class="pagination"></div>
                <pre id="error-log" style="display:none; background:#fff3f3; color:#b00020; padding:8px; border-radius:8px; margin-top:12px;"></pre>
            </div>
        </section>

        <section class="section" style="background: #f8f9fa;">
            <div class="container">
                <h2 class="section-title">Previous Thought Leadership</h2>
                <div class="section-subtitle">Explore past interviews, talks, and articles</div>
                <div class="thought-leadership-grid">
                    <div class="content-card">
                        <div class="content-type">Podcast</div>
                        <div class="content-body">
                            <h3>Avoiding Product Management Dogma</h3>
                            <p>Exploring independent thinking in product leadership and avoiding conventional wisdom traps.</p>
                            <p><a href="https://productmasterynow.com/blog/tei-130-avoiding-product-management-dogma-with-chris-spagnuolo/" target="_blank">Listen on Product Mastery Now</a></p>
                        </div>
                    </div>
                    <div class="content-card">
                        <div class="content-type">Video</div>
                        <div class="content-body">
                            <h3>Challenges Around Alignment and Autonomy</h3>
                            <p>Balancing team empowerment with strategic coordination in product organizations.</p>
                            <p><a href="https://www.youtube.com/watch?v=iNZN9DGgXYU" target="_blank">Watch on YouTube</a></p>
                        </div>
                    </div>
                    <div class="content-card">
                        <div class="content-type">Article</div>
                        <div class="content-body">
                            <h3>What Can Haruki Murakami Teach Us About Sustainable Pace?</h3>
                            <p>Lessons from literature on building sustainable leadership practices and long-term thinking.</p>
                            <p><a href="https://www.liminalarc.co/2014/11/haruki-murakami-teaches-sustainable-pace/" target="_blank">Read on Liminal Arc</a></p>
                        </div>
                    </div>
                    <div class="content-card">
                        <div class="content-type">Podcast</div>
                        <div class="content-body">
                            <h3>Innovation in the Enterprise</h3>
                            <p>Strategies for fostering innovation within large, established organizations.</p>
                            <p><a href="https://liminalarcgroup.podbean.com/e/it2-innovation-in-the-enterprise-chris-spagnuolo/" target="_blank">Listen on Liminal Arc</a></p>
                        </div>
                    </div>
                    <div class="content-card">
                        <div class="content-type">Video</div>
                        <div class="content-body">
                            <h3>Design Thinking in Practice</h3>
                            <p>Practical applications of design thinking methodologies in product development.</p>
                            <p><a href="https://www.youtube.com/watch?v=5_Ip-jA4hhg" target="_blank">Watch on YouTube</a></p>
                        </div>
                    </div>
                    <div class="content-card">
                        <div class="content-type">Article</div>
                        <div class="content-body">
                            <h3>Product Vision Tools: The Product Vision Board</h3>
                            <p>Practical frameworks for developing and communicating product vision across organizations.</p>
                            <p><a href="https://www.liminalarc.co/2014/03/product-vision-tools/" target="_blank">Read on Liminal Arc</a></p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <section class="contact-section section" id="contact">
        <div class="container">
            <h2 class="section-title">Let's Connect</h2>
            <p style="font-size: 1.2rem; opacity: 0.9; max-width: 600px; margin: 0 auto;">
                Interested in discussing product strategy, leadership challenges, or collaboration opportunities?
                I'd love to hear from you.
            </p>
            <div class="cta-buttons" style="margin-top: 2rem;">
                <a href="https://calendly.com/chrisspagnuolo/short" class="cta-button" target="_blank">Schedule a Meeting</a>
                <a href="index.html#contact" class="cta-button secondary">Contact Me</a>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Chris Spagnuolo. All rights reserved.</p>
        </div>
    </footer>

    <script src="script.js"></script>
    <script defer src="//_vercel/insights/script.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() { 
  if (window.lucide) lucide.createIcons(); 

  const PAGE_SIZE = 6;
  const PROJECT_ID = 'bcqvqm54';
  const DATASET = 'production';

  function getPageParam() {
    const url = new URL(window.location.href);
    const p = parseInt(url.searchParams.get('page') || '1', 10);
    return isNaN(p) || p < 1 ? 1 : p;
  }

  function formatDate(dateString) {
    return new Date(dateString).toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
  }

  function showError(err) {
    const el = document.getElementById('error-log');
    if (el) {
      el.style.display = 'block';
      el.textContent = String(err);
    }
    console.error(err);
  }

  // Function to convert Sanity rich text to plain text
  function extractText(blocks) {
    if (!blocks || !Array.isArray(blocks)) return '';
    
    return blocks
      .filter(block => block._type === 'block')
      .map(block => {
        if (block.children && Array.isArray(block.children)) {
          return block.children
            .filter(child => child._type === 'span')
            .map(child => child.text || '')
            .join('');
        }
        return '';
      })
      .join(' ')
      .substring(0, 150) + '...';
  }

  async function fetchFromSanity(query) {
    const encodedQuery = encodeURIComponent(query);
    const url = `https://${PROJECT_ID}.api.sanity.io/v2024-01-01/data/query/${DATASET}?query=${encodedQuery}`;
    
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error(`Sanity API error: ${response.status}`);
    }
    
    const data = await response.json();
    return data.result;
  }

  async function renderPosts() {
    const container = document.getElementById('latest-posts');
    const pager = document.getElementById('pager');

    try {
      const page = getPageParam();
      const start = (page - 1) * PAGE_SIZE;
      const end = start + PAGE_SIZE;

      // Fetch posts from Sanity using direct API
      const postsQuery = `*[_type == "post" && defined(publishedAt)] | order(publishedAt desc) [${start}...${end}] {
        title,
        slug,
        excerpt,
        publishedAt,
        body
      }`;

      const totalQuery = `count(*[_type == "post" && defined(publishedAt)])`;
      
      const [posts, total] = await Promise.all([
        fetchFromSanity(postsQuery),
        fetchFromSanity(totalQuery)
      ]);

      console.log('Fetched posts:', posts);
      console.log('Total posts:', total);

      const pages = Math.max(1, Math.ceil(total / PAGE_SIZE));

      // Render blog post cards
      if (posts && posts.length > 0) {
        container.innerHTML = posts.map(post => `
          <article class="content-card">
            <div class="content-type">Article</div>
            <div class="content-body">
              <h3><a href="blog-post.html?slug=${post.slug?.current || 'post'}">${post.title || 'Untitled'}</a></h3>
              <p class="muted" style="color:#666; margin:.25rem 0 0.6rem; font-size: 0.9rem;">
                ${post.publishedAt ? formatDate(post.publishedAt) : 'No date'}
              </p>
              <p>${post.excerpt || extractText(post.body) || 'No excerpt available.'}</p>
              <p style="margin-top:.6rem;">
                <a href="blog-post.html?slug=${post.slug?.current || 'post'}">Read the full article</a>
              </p>
            </div>
          </article>
        `).join('');
      } else {
        container.innerHTML = '<p>No posts found. Create some posts in your Sanity Studio!</p>';
      }

      // Generate pagination controls
      function createPageLink(pageNum, label, disabled = false, active = false) {
        const cls = ['page-link'];
        if (disabled) cls.push('disabled');
        if (active) cls.push('active');
        
        if (disabled) {
          return `<span class="${cls.join(' ')}">${label}</span>`;
        }
        
        const q = new URLSearchParams(window.location.search);
        q.set('page', pageNum);
        const href = `?${q.toString()}`;
        return `<a class="${cls.join(' ')}" href="${href}">${label}</a>`;
      }

      let paginationHtml = '';
      paginationHtml += createPageLink(Math.max(1, page - 1), '← Previous', page === 1);
      
      const startPage = Math.max(1, page - 2);
      const endPage = Math.min(pages, page + 2);
      
      if (startPage > 1) {
        paginationHtml += createPageLink(1, '1');
        if (startPage > 2) {
          paginationHtml += '<span class="page-ellipsis">...</span>';
        }
      }
      
      for (let i = startPage; i <= endPage; i++) {
        paginationHtml += createPageLink(i, i, false, i === page);
      }
      
      if (endPage < pages) {
        if (endPage < pages - 1) {
          paginationHtml += '<span class="page-ellipsis">...</span>';
        }
        paginationHtml += createPageLink(pages, pages);
      }
      
      paginationHtml += createPageLink(Math.min(pages, page + 1), 'Next →', page === pages);
      pager.innerHTML = paginationHtml;

    } catch(e) {
      showError('Error loading posts: ' + e.message);
      container.innerHTML = '<p>Unable to load posts. Make sure your Sanity Studio is running and you have published posts.</p>';
      pager.innerHTML = '';
    }
  }

  renderPosts();
});
    </script>
</body>
</html>
